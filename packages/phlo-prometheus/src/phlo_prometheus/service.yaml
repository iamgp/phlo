name: prometheus
description: Metrics collection and monitoring
category: observability
default: false
profile: observability

image: prom/prometheus:${PROMETHEUS_VERSION:-v3.1.0}

compose:
  restart: unless-stopped
  command:
    - "--config.file=/etc/prometheus/prometheus.yml"
    - "--storage.tsdb.path=/prometheus"
    - "--web.enable-lifecycle"
    - "--storage.tsdb.retention.time=30d"
  ports:
    - "${PROMETHEUS_PORT:-9090}:9090"
  volumes:
    - ./prometheus:/etc/prometheus:ro
    - ./volumes/prometheus:/prometheus
  healthcheck:
    test:
      [
        "CMD",
        "wget",
        "--quiet",
        "--tries=1",
        "--spider",
        "http://localhost:9090/-/healthy",
      ]
    interval: 10s
    timeout: 5s
    retries: 5

env_vars:
  PROMETHEUS_VERSION:
    default: v3.1.0
    description: Prometheus version
  PROMETHEUS_PORT:
    default: 9090
    description: Prometheus web UI port

files:
  - source: prometheus.yml
    dest: prometheus/prometheus.yml
