name: grafana
description: Metrics visualization and dashboards
category: observability
default: false
profile: observability

image: grafana/grafana:${GRAFANA_VERSION:-11.3.1}

depends_on:
  - prometheus
  - loki

compose:
  restart: unless-stopped
  labels:
    phlo.metrics.enabled: "true"
    phlo.metrics.port: "grafana:3000"
    phlo.metrics.path: "/metrics"
  environment:
    GF_SECURITY_ADMIN_USER: ${GRAFANA_ADMIN_USER:-admin}
    GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_ADMIN_PASSWORD:-admin}
    GF_USERS_ALLOW_SIGN_UP: "false"
  ports:
    - "${GRAFANA_PORT:-3003}:3000"
  volumes:
    - ./grafana/provisioning:/etc/grafana/provisioning:ro
    - ./grafana/dashboards:/etc/grafana/dashboards:ro
    - ./volumes/grafana:/var/lib/grafana
  healthcheck:
    test:
      [
        "CMD",
        "wget",
        "--quiet",
        "--tries=1",
        "--spider",
        "http://localhost:3000/api/health",
      ]
    interval: 10s
    timeout: 5s
    retries: 5

env_vars:
  GRAFANA_VERSION:
    default: "11.3.1"
    description: Grafana version
  GRAFANA_PORT:
    default: 3003
    description: Grafana web UI port
  GRAFANA_ADMIN_USER:
    default: admin
    description: Grafana admin username
  GRAFANA_ADMIN_PASSWORD:
    default: admin
    description: Grafana admin password
    secret: true

files:
  - source: provisioning
    dest: grafana/provisioning
  - source: dashboards
    dest: grafana/dashboards
