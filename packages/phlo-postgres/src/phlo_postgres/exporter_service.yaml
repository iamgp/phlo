name: postgres-exporter
description: Prometheus exporter for PostgreSQL metrics
category: observability
default: false
profile: observability

image: quay.io/prometheuscommunity/postgres-exporter:v0.15.0

depends_on:
  - postgres

compose:
  restart: unless-stopped
  labels:
    phlo.metrics.enabled: "true"
    phlo.metrics.port: "postgres-exporter:9187"
    phlo.metrics.path: "/metrics"
  environment:
    DATA_SOURCE_NAME: postgresql://${POSTGRES_USER:-phlo}:${POSTGRES_PASSWORD:-phlo}@postgres:5432/${POSTGRES_DB:-phlo}?sslmode=disable
  ports:
    - "${POSTGRES_EXPORTER_PORT:-9187}:9187"
  healthcheck:
    test:
      [
        "CMD",
        "wget",
        "--quiet",
        "--tries=1",
        "--spider",
        "http://localhost:9187/metrics",
      ]
    interval: 10s
    timeout: 5s
    retries: 5

env_vars:
  POSTGRES_EXPORTER_PORT:
    default: 9187
    description: Postgres exporter metrics port
