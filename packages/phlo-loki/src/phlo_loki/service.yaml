name: loki
description: Log aggregation and querying
category: observability
default: false
profile: observability

image: grafana/loki:${LOKI_VERSION:-3.2.1}

compose:
  restart: unless-stopped
  command: -config.file=/etc/loki/loki-config.yml
  ports:
    - "${LOKI_PORT:-3100}:3100"
  volumes:
    - ./loki:/etc/loki:ro
    - ./volumes/loki:/loki
  healthcheck:
    test:
      [
        "CMD",
        "wget",
        "--quiet",
        "--tries=1",
        "--spider",
        "http://localhost:3100/ready",
      ]
    interval: 10s
    timeout: 5s
    retries: 5

env_vars:
  LOKI_VERSION:
    default: "3.2.1"
    description: Loki version
  LOKI_PORT:
    default: 3100
    description: Loki API port

files:
  - source: loki-config.yml
    dest: loki/loki-config.yml
