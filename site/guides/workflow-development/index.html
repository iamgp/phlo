
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Phlo data lakehouse platform">
      
      
        <meta name="author" content="Phlo Team">
      
      
      
        <link rel="prev" href="../developer-guide/">
      
      
        <link rel="next" href="../dbt-development/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Workflow Development - Phlo Lakehouse Platform</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workflow-development-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Phlo Lakehouse Platform" class="md-header__button md-logo" aria-label="Phlo Lakehouse Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Phlo Lakehouse Platform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Workflow Development
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Phlo Lakehouse Platform" class="md-nav__button md-logo" aria-label="Phlo Lakehouse Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Phlo Lakehouse Platform
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../getting-started/installation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Workflow Development
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Development
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-your-first-data-pipeline-in-phlo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Building Your First Data Pipeline in Phlo
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-were-building" class="md-nav__link">
    <span class="md-ellipsis">
      
        What We're Building
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-define-your-data-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Define Your Data Schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Define Your Data Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-create-schema-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Create Schema Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-create-iceberg-table-schema-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Create Iceberg Table Schema (Optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-the-ingestion-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create the Ingestion Asset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create the Ingestion Asset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-add-api-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Add API Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-create-the-ingestion-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Create the Ingestion Asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 Registration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-test-the-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 Test the Ingestion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-bronze-layer-staging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create Bronze Layer (Staging)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Create Bronze Layer (Staging)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-define-the-source" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Define the Source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-create-the-staging-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Create the Staging Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-add-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Add Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-silver-layer-facts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Silver Layer (Facts)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Create Silver Layer (Facts)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-create-the-fact-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Create the Fact Table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-add-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Add Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-gold-layer-aggregations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create Gold Layer (Aggregations)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5: Create Gold Layer (Aggregations)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-create-daily-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Create Daily Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-create-location-dimension" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Create Location Dimension
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-create-marts-for-bi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Create Marts for BI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Create Marts for BI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-create-weather-overview-mart" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Create Weather Overview Mart
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-create-recent-readings-mart" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Create Recent Readings Mart
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-add-data-quality-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 7: Add Data Quality Checks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 7: Add Data Quality Checks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-create-quality-check-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Create Quality Check Asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-quality-check-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Quality Check Discovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-8-configure-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 8: Configure Publishing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 8: Configure Publishing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-update-publishing-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Update Publishing Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-create-publishing-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Create Publishing Asset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-9-add-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 9: Add Scheduling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 9: Add Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-create-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Create Schedule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-add-sensor-for-freshness" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Add Sensor for Freshness
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-10-test-and-deploy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 10: Test and Deploy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 10: Test and Deploy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-run-complete-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Run Complete Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-verify-each-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Verify Each Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-run-dbt-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3 Run dbt Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#104-create-superset-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.4 Create Superset Dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-incremental-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Incremental Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-partitioned-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Partitioned Assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-dynamic-cities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Dynamic Cities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Caching
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dbt-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dbt Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Modeling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dagster-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dagster Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugin Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-packages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Packages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../setup/hasura/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../packages/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Packages
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../reference/architecture/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../operations/operations-guide/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-your-first-data-pipeline-in-phlo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Building Your First Data Pipeline in Phlo
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-were-building" class="md-nav__link">
    <span class="md-ellipsis">
      
        What We're Building
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-define-your-data-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Define Your Data Schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Define Your Data Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-create-schema-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Create Schema Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-create-iceberg-table-schema-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Create Iceberg Table Schema (Optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-the-ingestion-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create the Ingestion Asset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create the Ingestion Asset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-add-api-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Add API Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-create-the-ingestion-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Create the Ingestion Asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 Registration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-test-the-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 Test the Ingestion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-bronze-layer-staging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create Bronze Layer (Staging)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Create Bronze Layer (Staging)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-define-the-source" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Define the Source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-create-the-staging-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Create the Staging Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-add-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Add Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-silver-layer-facts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Silver Layer (Facts)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Create Silver Layer (Facts)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-create-the-fact-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Create the Fact Table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-add-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Add Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-gold-layer-aggregations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create Gold Layer (Aggregations)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5: Create Gold Layer (Aggregations)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-create-daily-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Create Daily Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-create-location-dimension" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Create Location Dimension
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-create-marts-for-bi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Create Marts for BI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Create Marts for BI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-create-weather-overview-mart" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Create Weather Overview Mart
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-create-recent-readings-mart" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Create Recent Readings Mart
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-add-data-quality-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 7: Add Data Quality Checks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 7: Add Data Quality Checks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-create-quality-check-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Create Quality Check Asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-quality-check-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Quality Check Discovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-8-configure-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 8: Configure Publishing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 8: Configure Publishing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-update-publishing-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Update Publishing Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-create-publishing-asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Create Publishing Asset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-9-add-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 9: Add Scheduling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 9: Add Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-create-schedule" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Create Schedule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-add-sensor-for-freshness" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Add Sensor for Freshness
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-10-test-and-deploy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 10: Test and Deploy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 10: Test and Deploy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-run-complete-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Run Complete Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-verify-each-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Verify Each Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-run-dbt-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3 Run dbt Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#104-create-superset-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.4 Create Superset Dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-incremental-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Incremental Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-partitioned-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Partitioned Assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-dynamic-cities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Dynamic Cities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Caching
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="workflow-development-guide">Workflow Development Guide</h1>
<h2 id="building-your-first-data-pipeline-in-phlo">Building Your First Data Pipeline in Phlo</h2>
<p>This guide walks you through creating a complete data pipeline from scratch. We'll build a pipeline that ingests weather data from an API, transforms it through Bronze/Silver/Gold layers, and publishes it for analytics.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#pipeline-overview">Pipeline Overview</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#step-1-define-your-data-schema">Step 1: Define Your Data Schema</a></li>
<li><a href="#step-2-create-the-ingestion-asset">Step 2: Create the Ingestion Asset</a></li>
<li><a href="#step-3-create-bronze-layer-staging">Step 3: Create Bronze Layer (Staging)</a></li>
<li><a href="#step-4-create-silver-layer-facts">Step 4: Create Silver Layer (Facts)</a></li>
<li><a href="#step-5-create-gold-layer-aggregations">Step 5: Create Gold Layer (Aggregations)</a></li>
<li><a href="#step-6-create-marts-for-bi">Step 6: Create Marts for BI</a></li>
<li><a href="#step-7-add-data-quality-checks">Step 7: Add Data Quality Checks</a></li>
<li><a href="#step-8-configure-publishing">Step 8: Configure Publishing</a></li>
<li><a href="#step-9-add-scheduling">Step 9: Add Scheduling</a></li>
<li><a href="#step-10-test-and-deploy">Step 10: Test and Deploy</a></li>
<li><a href="#advanced-patterns">Advanced Patterns</a></li>
</ol>
<hr />
<h2 id="pipeline-overview">Pipeline Overview</h2>
<h3 id="what-were-building">What We're Building</h3>
<p>A weather data pipeline that:</p>
<ol>
<li>Fetches weather data from OpenWeather API</li>
<li>Stores raw data in Iceberg (Bronze)</li>
<li>Cleans and standardizes data (Silver)</li>
<li>Calculates daily statistics (Gold)</li>
<li>Publishes to PostgreSQL for dashboards (Marts)</li>
<li>Runs automatically every hour</li>
</ol>
<h3 id="architecture">Architecture</h3>
<pre><code>OpenWeather API
    ↓
[Dagster Asset: weather_data]
    ↓
Iceberg: raw.weather_observations
    ↓
[dbt: stg_weather_observations]
    ↓
Iceberg: bronze.stg_weather_observations
    ↓
[dbt: fct_weather_readings]
    ↓
Iceberg: silver.fct_weather_readings
    ↓
[dbt: mrt_daily_weather_summary]
    ↓
Iceberg: marts.mrt_daily_weather_summary
    ↓
[Dagster Asset: publish_weather_marts]
    ↓
PostgreSQL: marts.mrt_daily_weather_summary
    ↓
Superset Dashboard
</code></pre>
<hr />
<h2 id="prerequisites">Prerequisites</h2>
<p>Before starting, make sure you have:</p>
<ol>
<li>✅ Phlo running (<code>make up-core up-query</code>)</li>
<li>✅ Basic understanding of SQL</li>
<li>✅ OpenWeather API key (free at https://openweathermap.org/api)</li>
<li>✅ Text editor or IDE</li>
</ol>
<hr />
<h2 id="step-1-define-your-data-schema">Step 1: Define Your Data Schema</h2>
<p>First, let's define what our data looks like.</p>
<h3 id="11-create-schema-definition">1.1 Create Schema Definition</h3>
<p>Create a new file: <code>workflows/schemas/weather.py</code></p>
<pre><code class="language-python">&quot;&quot;&quot;Schema definitions for weather data.&quot;&quot;&quot;

import pandera as pa
from pandera.typing import Series
from datetime import datetime

class WeatherObservationSchema(pa.DataFrameModel):
    &quot;&quot;&quot;Schema for raw weather observations from OpenWeather API.&quot;&quot;&quot;

    # Identifiers
    city_name: Series[str] = pa.Field(description=&quot;City name&quot;)
    country: Series[str] = pa.Field(description=&quot;Country code&quot;)
    latitude: Series[float] = pa.Field(ge=-90, le=90, description=&quot;Latitude&quot;)
    longitude: Series[float] = pa.Field(ge=-180, le=180, description=&quot;Longitude&quot;)

    # Weather data
    temperature: Series[float] = pa.Field(description=&quot;Temperature in Celsius&quot;)
    feels_like: Series[float] = pa.Field(description=&quot;Feels like temperature&quot;)
    humidity: Series[int] = pa.Field(ge=0, le=100, description=&quot;Humidity percentage&quot;)
    pressure: Series[int] = pa.Field(description=&quot;Atmospheric pressure in hPa&quot;)
    wind_speed: Series[float] = pa.Field(ge=0, description=&quot;Wind speed in m/s&quot;)

    # Weather conditions
    weather_main: Series[str] = pa.Field(description=&quot;Main weather condition (Rain, Clear, etc.)&quot;)
    weather_description: Series[str] = pa.Field(description=&quot;Detailed description&quot;)

    # Timestamps
    observation_time: Series[datetime] = pa.Field(description=&quot;Time of observation&quot;)
    sunrise_time: Series[datetime] = pa.Field(description=&quot;Sunrise time&quot;)
    sunset_time: Series[datetime] = pa.Field(description=&quot;Sunset time&quot;)

    class Config:
        &quot;&quot;&quot;Pandera configuration.&quot;&quot;&quot;
        coerce = True  # Coerce types automatically
        strict = False  # Allow extra columns


class WeatherReadingSchema(pa.DataFrameModel):
    &quot;&quot;&quot;Schema for transformed weather readings (silver layer).&quot;&quot;&quot;

    # All fields from raw, plus calculated fields
    city_name: Series[str]
    temperature: Series[float]
    humidity: Series[int]
    observation_time: Series[datetime]

    # Calculated fields
    temperature_f: Series[float] = pa.Field(description=&quot;Temperature in Fahrenheit&quot;)
    temp_category: Series[str] = pa.Field(
        isin=[&quot;Freezing&quot;, &quot;Cold&quot;, &quot;Mild&quot;, &quot;Warm&quot;, &quot;Hot&quot;],
        description=&quot;Temperature category&quot;
    )
    is_daytime: Series[bool] = pa.Field(description=&quot;True if during daylight&quot;)

    class Config:
        coerce = True
        strict = False
</code></pre>
<p><strong>What this does:</strong></p>
<ul>
<li>Defines the structure of our data</li>
<li>Validates data types</li>
<li>Adds constraints (e.g., humidity 0-100%)</li>
<li>Documents each field</li>
<li>Enables automatic testing</li>
</ul>
<h3 id="12-create-iceberg-table-schema-optional">1.2 Create Iceberg Table Schema (Optional)</h3>
<p>Create: <code>workflows/schemas/iceberg_weather.py</code></p>
<pre><code class="language-python">&quot;&quot;&quot;Iceberg table schemas for weather data.&quot;&quot;&quot;

from pyiceberg.schema import Schema
from pyiceberg.types import (
    NestedField,
    StringType,
    FloatType,
    IntegerType,
    TimestampType,
    BooleanType,
)

WEATHER_OBSERVATION_SCHEMA = Schema(
    NestedField(1, &quot;city_name&quot;, StringType(), required=True),
    NestedField(2, &quot;country&quot;, StringType(), required=True),
    NestedField(3, &quot;latitude&quot;, FloatType(), required=True),
    NestedField(4, &quot;longitude&quot;, FloatType(), required=True),
    NestedField(5, &quot;temperature&quot;, FloatType(), required=True),
    NestedField(6, &quot;feels_like&quot;, FloatType(), required=True),
    NestedField(7, &quot;humidity&quot;, IntegerType(), required=True),
    NestedField(8, &quot;pressure&quot;, IntegerType(), required=True),
    NestedField(9, &quot;wind_speed&quot;, FloatType(), required=True),
    NestedField(10, &quot;weather_main&quot;, StringType(), required=True),
    NestedField(11, &quot;weather_description&quot;, StringType(), required=True),
    NestedField(12, &quot;observation_time&quot;, TimestampType(), required=True),
    NestedField(13, &quot;sunrise_time&quot;, TimestampType(), required=True),
    NestedField(14, &quot;sunset_time&quot;, TimestampType(), required=True),
)

WEATHER_READING_SCHEMA = Schema(
    # Raw fields
    NestedField(1, &quot;city_name&quot;, StringType(), required=True),
    NestedField(2, &quot;country&quot;, StringType(), required=True),
    NestedField(3, &quot;temperature&quot;, FloatType(), required=True),
    NestedField(4, &quot;humidity&quot;, IntegerType(), required=True),
    NestedField(5, &quot;observation_time&quot;, TimestampType(), required=True),

    # Calculated fields
    NestedField(6, &quot;temperature_f&quot;, FloatType(), required=False),
    NestedField(7, &quot;temp_category&quot;, StringType(), required=False),
    NestedField(8, &quot;is_daytime&quot;, BooleanType(), required=False),
)
</code></pre>
<hr />
<h2 id="step-2-create-the-ingestion-asset">Step 2: Create the Ingestion Asset</h2>
<p>Now let's fetch data from the OpenWeather API and store it in Iceberg.</p>
<h3 id="21-add-api-configuration">2.1 Add API Configuration</h3>
<p>Add your API configuration to <code>.env</code>:</p>
<pre><code class="language-bash"># Weather API Configuration
OPENWEATHER_API_KEY=your_api_key_here
OPENWEATHER_CITIES=London,GB;New York,US;Tokyo,JP;Sydney,AU
</code></pre>
<h3 id="22-create-the-ingestion-asset">2.2 Create the Ingestion Asset</h3>
<p>Create: <code>workflows/ingestion/weather_assets.py</code></p>
<p><strong>Important:</strong> We use <strong>DLT (Data Load Tool)</strong> for ingestion, following Phlo's established pattern. DLT handles:</p>
<ul>
<li>Robust data loading with retries</li>
<li>Schema inference and validation</li>
<li>Parquet file staging</li>
<li>State management</li>
</ul>
<pre><code class="language-python">&quot;&quot;&quot;Weather data ingestion assets using DLT.&quot;&quot;&quot;

from __future__ import annotations

import time
from datetime import datetime, timezone
from pathlib import Path
from typing import Any

import dagster as dg
import dlt
import requests

from phlo.config import config
from phlo_iceberg.resource import IcebergResource
from workflows.schemas.weather import WeatherObservationSchema
from workflows.schemas.iceberg_weather import WEATHER_OBSERVATION_SCHEMA


@dg.asset(
    name=&quot;dlt_weather_data&quot;,
    group_name=&quot;weather&quot;,
    compute_kind=&quot;dlt+pyiceberg&quot;,
    description=&quot;Fetches current weather data from OpenWeather API using DLT&quot;,
    retry_policy=dg.RetryPolicy(max_retries=3, delay=30),
)
def weather_data(
    context: dg.AssetExecutionContext,
    iceberg: IcebergResource,
) -&gt; dg.MaterializeResult:
    &quot;&quot;&quot;
    Ingest weather data using two-step DLT pattern (like glucose example):

    1. Fetch data from OpenWeather API
    2. DLT stages data to parquet files
    3. PyIceberg registers/appends to Iceberg table

    Why DLT?
    - Handles schema evolution automatically
    - Robust error handling and retries
    - Consistent with other ingestion assets (dlt_glucose_entries)
    - State management for incremental loads
    &quot;&quot;&quot;
    table_name = f&quot;{config.iceberg_default_namespace}.weather_observations&quot;
    pipeline_name = &quot;weather_openweathermap&quot;

    # Setup DLT directories
    pipelines_base_dir = Path.home() / &quot;.dlt&quot; / &quot;pipelines&quot; / &quot;weather&quot;
    pipelines_base_dir.mkdir(parents=True, exist_ok=True)

    context.log.info(f&quot;Starting weather data ingestion&quot;)
    context.log.info(f&quot;Target table: {table_name}&quot;)

    try:
        # Step 1: Fetch data from OpenWeather API
        context.log.info(&quot;Fetching data from OpenWeather API...&quot;)

        cities = [
            city.strip().split(&quot;,&quot;)
            for city in config.openweather_cities.split(&quot;;&quot;)
        ]

        weather_records = []

        for city_name, country in cities:
            context.log.info(f&quot;Fetching weather for {city_name}, {country}&quot;)

            url = &quot;https://api.openweathermap.org/data/2.5/weather&quot;
            params = {
                &quot;q&quot;: f&quot;{city_name},{country}&quot;,
                &quot;appid&quot;: config.openweather_api_key,
                &quot;units&quot;: &quot;metric&quot;,  # Celsius
            }

            try:
                response = requests.get(url, params=params, timeout=10)
                response.raise_for_status()
                data = response.json()

                # Extract and structure data
                record = {
                    &quot;city_name&quot;: data[&quot;name&quot;],
                    &quot;country&quot;: data[&quot;sys&quot;][&quot;country&quot;],
                    &quot;latitude&quot;: data[&quot;coord&quot;][&quot;lat&quot;],
                    &quot;longitude&quot;: data[&quot;coord&quot;][&quot;lon&quot;],
                    &quot;temperature&quot;: data[&quot;main&quot;][&quot;temp&quot;],
                    &quot;feels_like&quot;: data[&quot;main&quot;][&quot;feels_like&quot;],
                    &quot;humidity&quot;: data[&quot;main&quot;][&quot;humidity&quot;],
                    &quot;pressure&quot;: data[&quot;main&quot;][&quot;pressure&quot;],
                    &quot;wind_speed&quot;: data[&quot;wind&quot;][&quot;speed&quot;],
                    &quot;weather_main&quot;: data[&quot;weather&quot;][0][&quot;main&quot;],
                    &quot;weather_description&quot;: data[&quot;weather&quot;][0][&quot;description&quot;],
                    &quot;observation_time&quot;: datetime.fromtimestamp(data[&quot;dt&quot;], tz=timezone.utc),
                    &quot;sunrise_time&quot;: datetime.fromtimestamp(data[&quot;sys&quot;][&quot;sunrise&quot;], tz=timezone.utc),
                    &quot;sunset_time&quot;: datetime.fromtimestamp(data[&quot;sys&quot;][&quot;sunset&quot;], tz=timezone.utc),
                }

                weather_records.append(record)

            except requests.RequestException as e:
                context.log.error(f&quot;Failed to fetch {city_name}: {e}&quot;)
                continue

        if not weather_records:
            context.log.info(&quot;No weather data fetched, skipping&quot;)
            return dg.MaterializeResult(
                metadata={
                    &quot;rows_loaded&quot;: dg.MetadataValue.int(0),
                    &quot;status&quot;: dg.MetadataValue.text(&quot;no_data&quot;),
                }
            )

        context.log.info(f&quot;Successfully fetched {len(weather_records)} weather observations&quot;)

        # Add phlo ingestion timestamp
        ingestion_timestamp = datetime.now(timezone.utc)
        for record in weather_records:
            record[&quot;_cascade_ingested_at&quot;] = ingestion_timestamp

        # Step 2: Stage to parquet using DLT
        context.log.info(&quot;Staging data to parquet via DLT...&quot;)
        start_time_ts = time.time()

        local_staging_root = (pipelines_base_dir / pipeline_name / &quot;stage&quot;).resolve()
        local_staging_root.mkdir(parents=True, exist_ok=True)

        # Create DLT pipeline with filesystem destination targeting local staging
        filesystem_destination = dlt.destinations.filesystem(
            bucket_url=local_staging_root.as_uri(),
        )

        pipeline = dlt.pipeline(
            pipeline_name=pipeline_name,
            destination=filesystem_destination,
            dataset_name=&quot;weather&quot;,
            pipelines_dir=str(pipelines_base_dir),
        )

        # Define DLT resource
        @dlt.resource(name=&quot;weather_observations&quot;, write_disposition=&quot;replace&quot;)
        def provide_weather() -&gt; Any:
            yield weather_records

        # Run DLT pipeline to stage parquet files
        info = pipeline.run(
            provide_weather(),
            loader_file_format=&quot;parquet&quot;,
        )

        if not info.load_packages:
            raise RuntimeError(&quot;DLT pipeline produced no load packages&quot;)

        # Get parquet file path
        load_package = info.load_packages[0]
        completed_jobs = load_package.jobs.get(&quot;completed_jobs&quot;) or []

        # Filter for actual parquet files (exclude pipeline state and other files)
        parquet_files = [job for job in completed_jobs if job.file_path.endswith('.parquet')]

        if not parquet_files:
            raise RuntimeError(&quot;DLT pipeline completed without producing parquet files&quot;)

        parquet_path = Path(parquet_files[0].file_path)
        if not parquet_path.is_absolute():
            parquet_path = (local_staging_root / parquet_path).resolve()

        dlt_elapsed = time.time() - start_time_ts
        context.log.info(f&quot;DLT staging completed in {dlt_elapsed:.2f}s&quot;)

        # Step 3: Ensure Iceberg table exists
        context.log.info(f&quot;Ensuring Iceberg table {table_name} exists...&quot;)
        iceberg.ensure_table(
            table_name=table_name,
            schema=WEATHER_OBSERVATION_SCHEMA,
            partition_spec=None,
        )

        # Step 4: Append to Iceberg table
        context.log.info(&quot;Appending data to Iceberg table...&quot;)
        iceberg.append_parquet(
            table_name=table_name,
            data_path=str(parquet_path),
        )

        total_elapsed = time.time() - start_time_ts
        rows_loaded = len(weather_records)
        context.log.info(f&quot;Ingestion completed successfully in {total_elapsed:.2f}s&quot;)
        context.log.info(f&quot;Loaded {rows_loaded} rows to {table_name}&quot;)

        return dg.MaterializeResult(
            metadata={
                &quot;rows_loaded&quot;: dg.MetadataValue.int(rows_loaded),
                &quot;cities&quot;: dg.MetadataValue.text(&quot;, &quot;.join([r[&quot;city_name&quot;] for r in weather_records])),
                &quot;table_name&quot;: dg.MetadataValue.text(table_name),
                &quot;dlt_elapsed_seconds&quot;: dg.MetadataValue.float(dlt_elapsed),
                &quot;total_elapsed_seconds&quot;: dg.MetadataValue.float(total_elapsed),
            }
        )

    except requests.RequestException as e:
        context.log.error(f&quot;API request failed: {e}&quot;)
        raise RuntimeError(f&quot;Failed to fetch data from OpenWeather API&quot;) from e

    except Exception as e:
        context.log.error(f&quot;Ingestion failed: {e}&quot;)
        raise RuntimeError(f&quot;Weather data ingestion failed: {e}&quot;) from e


def build_weather_ingestion_defs() -&gt; dg.Definitions:
    &quot;&quot;&quot;Build definitions for weather ingestion assets.&quot;&quot;&quot;
    return dg.Definitions(
        assets=[weather_data],
    )
</code></pre>
<h3 id="24-registration">2.4 Registration</h3>
<p>No manual registration is needed. Phlo discovers all Python files under <code>workflows/</code> automatically.</p>
<h3 id="25-test-the-ingestion">2.5 Test the Ingestion</h3>
<pre><code class="language-bash"># Reload Dagster
docker-compose restart dagster-webserver dagster-daemon

# Open Dagster UI
# Navigate to Assets → dlt_weather_data
# Click &quot;Materialize&quot;

# Or use CLI
dagster asset materialize -m phlo.framework.definitions -a dlt_weather_data
</code></pre>
<p><strong>What just happened?</strong></p>
<ol>
<li>Fetched weather data from the OpenWeather API</li>
<li>DLT staged the data to local parquet files with schema validation</li>
<li>PyIceberg appended the parquet to the Iceberg table</li>
<li>Nessie catalog updated with the new snapshot</li>
</ol>
<p><strong>Why DLT?</strong></p>
<ul>
<li>Consistent with the glucose example pattern (<code>dlt_glucose_entries</code>)</li>
<li>Handles schema evolution automatically</li>
<li>Robust parquet file generation with proper typing</li>
<li>State management for incremental loads</li>
<li>Better separation of concerns (fetch → DLT stage → PyIceberg register)</li>
<li>Matches established Phlo pattern for all ingestion assets</li>
</ul>
<p><strong>Verify:</strong></p>
<pre><code class="language-sql">-- Connect to Trino
docker-compose exec trino trino

-- Query the data
SELECT * FROM iceberg.raw.weather_observations;
</code></pre>
<hr />
<h2 id="step-3-create-bronze-layer-staging">Step 3: Create Bronze Layer (Staging)</h2>
<p>The Bronze layer cleans and standardizes raw data.</p>
<h3 id="31-define-the-source">3.1 Define the Source</h3>
<p>Create: <code>transforms/dbt/models/sources/sources_weather.yml</code></p>
<pre><code class="language-yaml">version: 2

sources:
  - name: raw
    description: &quot;Raw data layer - data as ingested from sources&quot;
    schema: raw

    tables:
      - name: weather_observations
        description: &quot;Raw weather observations from OpenWeather API&quot;
        columns:
          - name: city_name
            description: &quot;City name&quot;
            tests:
              - not_null

          - name: observation_time
            description: &quot;When the observation was recorded&quot;
            tests:
              - not_null

          - name: temperature
            description: &quot;Temperature in Celsius&quot;
            tests:
              - not_null
</code></pre>
<h3 id="32-create-the-staging-model">3.2 Create the Staging Model</h3>
<p>Create: <code>transforms/dbt/models/bronze/stg_weather_observations.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='bronze',
        tags=['weather', 'bronze']
    )
}}

WITH source AS (
    SELECT * FROM {{ source('raw', 'weather_observations') }}
),

cleaned AS (
    SELECT
        -- Identifiers
        city_name,
        country,
        ROUND(CAST(latitude AS DOUBLE), 4) AS latitude,
        ROUND(CAST(longitude AS DOUBLE), 4) AS longitude,

        -- Weather measurements
        ROUND(CAST(temperature AS DOUBLE), 2) AS temperature_c,
        ROUND(CAST(feels_like AS DOUBLE), 2) AS feels_like_c,
        CAST(humidity AS INTEGER) AS humidity_pct,
        CAST(pressure AS INTEGER) AS pressure_hpa,
        ROUND(CAST(wind_speed AS DOUBLE), 2) AS wind_speed_ms,

        -- Conditions
        LOWER(TRIM(weather_main)) AS weather_main,
        LOWER(TRIM(weather_description)) AS weather_description,

        -- Timestamps
        CAST(observation_time AS TIMESTAMP) AS observation_timestamp,
        CAST(sunrise_time AS TIMESTAMP) AS sunrise_timestamp,
        CAST(sunset_time AS TIMESTAMP) AS sunset_timestamp,

        -- Metadata
        DATE(observation_time) AS observation_date,
        HOUR(observation_time) AS observation_hour

    FROM source
    WHERE
        -- Data quality filters
        temperature IS NOT NULL
        AND observation_time IS NOT NULL
        AND city_name IS NOT NULL
        -- Remove outliers
        AND temperature BETWEEN -50 AND 60  -- Reasonable temp range
        AND humidity BETWEEN 0 AND 100
        AND wind_speed &gt;= 0
)

SELECT * FROM cleaned
</code></pre>
<p><strong>What this does:</strong></p>
<ul>
<li>Standardizes column names (e.g., <code>temperature</code> → <code>temperature_c</code>)</li>
<li>Converts types explicitly</li>
<li>Rounds numeric values</li>
<li>Standardizes text (lowercase, trim)</li>
<li>Adds derived date/hour fields</li>
<li>Filters out invalid data</li>
<li>Removes outliers</li>
</ul>
<h3 id="33-add-tests">3.3 Add Tests</h3>
<p>Create: <code>transforms/dbt/models/bronze/schema.yml</code></p>
<pre><code class="language-yaml">version: 2

models:
  - name: stg_weather_observations
    description: &quot;Cleaned and standardized weather observations&quot;
    columns:
      - name: city_name
        description: &quot;City name&quot;
        tests:
          - not_null

      - name: temperature_c
        description: &quot;Temperature in Celsius&quot;
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -50
              max_value: 60

      - name: humidity_pct
        description: &quot;Humidity percentage&quot;
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100

      - name: observation_timestamp
        description: &quot;Observation timestamp&quot;
        tests:
          - not_null

      - name: observation_date
        description: &quot;Observation date&quot;
        tests:
          - not_null
</code></pre>
<hr />
<h2 id="step-4-create-silver-layer-facts">Step 4: Create Silver Layer (Facts)</h2>
<p>The Silver layer adds business logic and calculated fields.</p>
<h3 id="41-create-the-fact-table">4.1 Create the Fact Table</h3>
<p>Create: <code>transforms/dbt/models/silver/fct_weather_readings.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='silver',
        tags=['weather', 'silver', 'fact']
    )
}}

WITH staged AS (
    SELECT * FROM {{ ref('stg_weather_observations') }}
),

enriched AS (
    SELECT
        -- All original fields
        *,

        -- Temperature conversions
        ROUND((temperature_c * 9.0 / 5.0) + 32, 2) AS temperature_f,
        ROUND((feels_like_c * 9.0 / 5.0) + 32, 2) AS feels_like_f,

        -- Temperature category
        CASE
            WHEN temperature_c &lt; 0 THEN 'Freezing'
            WHEN temperature_c &lt; 10 THEN 'Cold'
            WHEN temperature_c &lt; 20 THEN 'Mild'
            WHEN temperature_c &lt; 30 THEN 'Warm'
            ELSE 'Hot'
        END AS temp_category,

        -- Comfort index (simplified)
        CASE
            WHEN humidity_pct &gt; 80 AND temperature_c &gt; 25 THEN 'Uncomfortable'
            WHEN humidity_pct &lt; 30 AND temperature_c &lt; 10 THEN 'Dry-Cold'
            ELSE 'Comfortable'
        END AS comfort_level,

        -- Wind category (Beaufort scale simplified)
        CASE
            WHEN wind_speed_ms &lt; 0.3 THEN 'Calm'
            WHEN wind_speed_ms &lt; 3.3 THEN 'Light'
            WHEN wind_speed_ms &lt; 7.9 THEN 'Moderate'
            WHEN wind_speed_ms &lt; 13.8 THEN 'Fresh'
            ELSE 'Strong'
        END AS wind_category,

        -- Daylight indicator
        CASE
            WHEN observation_timestamp BETWEEN sunrise_timestamp AND sunset_timestamp
            THEN TRUE
            ELSE FALSE
        END AS is_daytime,

        -- Daylight duration (hours)
        ROUND(
            CAST(sunset_timestamp AS BIGINT) - CAST(sunrise_timestamp AS BIGINT)
        ) / 3600.0 AS daylight_hours,

        -- Weather condition grouping
        CASE
            WHEN weather_main IN ('rain', 'drizzle', 'thunderstorm') THEN 'Precipitation'
            WHEN weather_main IN ('snow', 'sleet') THEN 'Winter Precipitation'
            WHEN weather_main IN ('clear', 'clouds') THEN 'Dry'
            WHEN weather_main IN ('fog', 'mist', 'haze') THEN 'Low Visibility'
            ELSE 'Other'
        END AS weather_category,

        -- Location identifier (for grouping)
        city_name || ', ' || country AS location_key

    FROM staged
)

SELECT * FROM enriched
</code></pre>
<p><strong>What this does:</strong></p>
<ul>
<li>Converts Celsius to Fahrenheit</li>
<li>Categorizes temperature (Freezing/Cold/Mild/Warm/Hot)</li>
<li>Calculates comfort level</li>
<li>Categorizes wind speed</li>
<li>Determines if daytime or nighttime</li>
<li>Calculates daylight duration</li>
<li>Groups weather conditions</li>
<li>Creates location key for grouping</li>
</ul>
<h3 id="42-add-tests">4.2 Add Tests</h3>
<p>Create: <code>transforms/dbt/models/silver/schema.yml</code></p>
<pre><code class="language-yaml">version: 2

models:
  - name: fct_weather_readings
    description: &quot;Weather readings with calculated metrics and categorizations&quot;
    columns:
      - name: location_key
        description: &quot;Unique location identifier&quot;
        tests:
          - not_null

      - name: temperature_f
        description: &quot;Temperature in Fahrenheit&quot;
        tests:
          - not_null

      - name: temp_category
        description: &quot;Temperature category&quot;
        tests:
          - not_null
          - accepted_values:
              values: [&quot;Freezing&quot;, &quot;Cold&quot;, &quot;Mild&quot;, &quot;Warm&quot;, &quot;Hot&quot;]

      - name: is_daytime
        description: &quot;True if observation during daylight&quot;
        tests:
          - not_null
</code></pre>
<hr />
<h2 id="step-5-create-gold-layer-aggregations">Step 5: Create Gold Layer (Aggregations)</h2>
<p>The Gold layer creates aggregated, business-ready datasets.</p>
<h3 id="51-create-daily-summary">5.1 Create Daily Summary</h3>
<p>Create: <code>transforms/dbt/models/gold/agg_daily_weather_summary.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='gold',
        tags=['weather', 'gold', 'aggregation']
    )
}}

WITH weather_readings AS (
    SELECT * FROM {{ ref('fct_weather_readings') }}
),

daily_stats AS (
    SELECT
        observation_date,
        location_key,
        city_name,
        country,

        -- Temperature statistics
        COUNT(*) AS reading_count,
        ROUND(AVG(temperature_c), 2) AS avg_temp_c,
        ROUND(MIN(temperature_c), 2) AS min_temp_c,
        ROUND(MAX(temperature_c), 2) AS max_temp_c,
        ROUND(AVG(temperature_f), 2) AS avg_temp_f,

        -- Feels like temperature
        ROUND(AVG(feels_like_c), 2) AS avg_feels_like_c,

        -- Humidity statistics
        ROUND(AVG(humidity_pct), 2) AS avg_humidity_pct,
        MIN(humidity_pct) AS min_humidity_pct,
        MAX(humidity_pct) AS max_humidity_pct,

        -- Wind statistics
        ROUND(AVG(wind_speed_ms), 2) AS avg_wind_speed_ms,
        ROUND(MAX(wind_speed_ms), 2) AS max_wind_speed_ms,

        -- Pressure statistics
        ROUND(AVG(pressure_hpa), 2) AS avg_pressure_hpa,

        -- Daylight info (should be consistent per day)
        AVG(daylight_hours) AS daylight_hours,

        -- Weather conditions (most common)
        MODE() WITHIN GROUP (ORDER BY weather_main) AS predominant_weather,
        MODE() WITHIN GROUP (ORDER BY temp_category) AS predominant_temp_category,

        -- Comfort analysis
        SUM(CASE WHEN comfort_level = 'Comfortable' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) AS pct_comfortable,

        -- Precipitation indicator
        MAX(CASE WHEN weather_category = 'Precipitation' THEN 1 ELSE 0 END) AS had_precipitation

    FROM weather_readings
    GROUP BY
        observation_date,
        location_key,
        city_name,
        country
)

SELECT * FROM daily_stats
ORDER BY observation_date DESC, location_key
</code></pre>
<h3 id="52-create-location-dimension">5.2 Create Location Dimension</h3>
<p>Create: <code>transforms/dbt/models/gold/dim_location.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='gold',
        tags=['weather', 'gold', 'dimension']
    )
}}

WITH locations AS (
    SELECT DISTINCT
        location_key,
        city_name,
        country,
        latitude,
        longitude
    FROM {{ ref('stg_weather_observations') }}
)

SELECT
    ROW_NUMBER() OVER (ORDER BY location_key) AS location_id,
    location_key,
    city_name,
    country,
    latitude,
    longitude,
    -- Add region/continent based on country (simplified)
    CASE
        WHEN country IN ('US', 'CA', 'MX') THEN 'North America'
        WHEN country IN ('GB', 'FR', 'DE', 'IT', 'ES') THEN 'Europe'
        WHEN country IN ('JP', 'CN', 'IN', 'KR') THEN 'Asia'
        WHEN country IN ('AU', 'NZ') THEN 'Oceania'
        ELSE 'Other'
    END AS region
FROM locations
</code></pre>
<hr />
<h2 id="step-6-create-marts-for-bi">Step 6: Create Marts for BI</h2>
<p>Marts are optimized for BI tools and end-user queries.</p>
<h3 id="61-create-weather-overview-mart">6.1 Create Weather Overview Mart</h3>
<p>Create: <code>transforms/dbt/models/marts_postgres/mrt_weather_overview.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='marts',
        tags=['weather', 'marts', 'postgres']
    )
}}

WITH daily_summary AS (
    SELECT * FROM {{ ref('agg_daily_weather_summary') }}
),

location_dim AS (
    SELECT * FROM {{ ref('dim_location') }}
),

enriched AS (
    SELECT
        d.observation_date,
        d.location_key,
        d.city_name,
        d.country,
        l.region,

        -- Temperature metrics
        d.avg_temp_c,
        d.min_temp_c,
        d.max_temp_c,
        d.avg_temp_f,
        d.avg_feels_like_c,
        d.max_temp_c - d.min_temp_c AS temp_range_c,

        -- Other metrics
        d.avg_humidity_pct,
        d.avg_wind_speed_ms,
        d.avg_pressure_hpa,
        d.daylight_hours,

        -- Weather conditions
        d.predominant_weather,
        d.predominant_temp_category,
        d.pct_comfortable,
        d.had_precipitation,

        -- Metadata
        d.reading_count,
        CURRENT_TIMESTAMP AS last_updated

    FROM daily_summary d
    LEFT JOIN location_dim l ON d.location_key = l.location_key
)

SELECT * FROM enriched
ORDER BY observation_date DESC, city_name
</code></pre>
<h3 id="62-create-recent-readings-mart">6.2 Create Recent Readings Mart</h3>
<p>Create: <code>transforms/dbt/models/marts_postgres/mrt_recent_weather.sql</code></p>
<pre><code class="language-sql">{{
    config(
        materialized='table',
        schema='marts',
        tags=['weather', 'marts', 'postgres']
    )
}}

WITH recent_readings AS (
    SELECT
        location_key,
        city_name,
        country,
        temperature_c,
        temperature_f,
        feels_like_c,
        humidity_pct,
        wind_speed_ms,
        weather_main,
        weather_description,
        temp_category,
        comfort_level,
        is_daytime,
        observation_timestamp,

        -- Rank by recency per location
        ROW_NUMBER() OVER (
            PARTITION BY location_key
            ORDER BY observation_timestamp DESC
        ) AS recency_rank

    FROM {{ ref('fct_weather_readings') }}
    WHERE observation_timestamp &gt;= CURRENT_TIMESTAMP - INTERVAL '24' HOUR
)

SELECT
    location_key,
    city_name,
    country,
    temperature_c,
    temperature_f,
    feels_like_c,
    humidity_pct,
    wind_speed_ms,
    weather_main,
    weather_description,
    temp_category,
    comfort_level,
    is_daytime,
    observation_timestamp,
    CURRENT_TIMESTAMP AS refreshed_at
FROM recent_readings
WHERE recency_rank = 1  -- Most recent reading per location
ORDER BY city_name
</code></pre>
<hr />
<h2 id="step-7-add-data-quality-checks">Step 7: Add Data Quality Checks</h2>
<p>Quality checks ensure your data meets expectations.</p>
<h3 id="71-create-quality-check-asset">7.1 Create Quality Check Asset</h3>
<p>Create: <code>workflows/quality/weather.py</code></p>
<pre><code class="language-python">&quot;&quot;&quot;Data quality checks for weather pipeline.&quot;&quot;&quot;

import dagster as dg
import pandas as pd
from dagster_pandera import pandera_schema_to_dagster_type

from workflows.schemas.weather import WeatherObservationSchema, WeatherReadingSchema
from phlo_trino.resource import TrinoResource


@dg.asset(
    name=&quot;weather_quality_check_raw&quot;,
    group_name=&quot;weather_quality&quot;,
    deps=[&quot;weather_data&quot;],
    description=&quot;Quality checks for raw weather data&quot;,
)
def check_raw_weather_quality(
    context: dg.AssetExecutionContext,
    trino: TrinoResource,
) -&gt; dg.MaterializeResult:
    &quot;&quot;&quot;
    Perform quality checks on raw weather data.

    Checks:
    - Record count
    - Null values
    - Value ranges
    - Duplicate detection
    &quot;&quot;&quot;
    query = &quot;&quot;&quot;
    SELECT
        COUNT(*) as total_records,
        COUNT(DISTINCT city_name) as unique_cities,
        SUM(CASE WHEN temperature IS NULL THEN 1 ELSE 0 END) as null_temperatures,
        MIN(temperature) as min_temp,
        MAX(temperature) as max_temp,
        MIN(observation_time) as earliest_observation,
        MAX(observation_time) as latest_observation
    FROM iceberg.raw.weather_observations
    &quot;&quot;&quot;

    result = trino.execute(query)
    row = result[0]

    # Assertions
    assert row[&quot;total_records&quot;] &gt; 0, &quot;No records found&quot;
    assert row[&quot;unique_cities&quot;] &gt; 0, &quot;No cities found&quot;
    assert row[&quot;null_temperatures&quot;] == 0, f&quot;Found {row['null_temperatures']} null temperatures&quot;
    assert -50 &lt;= row[&quot;min_temp&quot;] &lt;= 60, f&quot;Temperature out of range: {row['min_temp']}&quot;
    assert -50 &lt;= row[&quot;max_temp&quot;] &lt;= 60, f&quot;Temperature out of range: {row['max_temp']}&quot;

    context.log.info(f&quot;✓ Quality checks passed&quot;)
    context.log.info(f&quot;  Total records: {row['total_records']}&quot;)
    context.log.info(f&quot;  Unique cities: {row['unique_cities']}&quot;)
    context.log.info(f&quot;  Temperature range: {row['min_temp']}°C to {row['max_temp']}°C&quot;)

    return dg.MaterializeResult(
        metadata={
            &quot;total_records&quot;: row[&quot;total_records&quot;],
            &quot;unique_cities&quot;: row[&quot;unique_cities&quot;],
            &quot;min_temp&quot;: row[&quot;min_temp&quot;],
            &quot;max_temp&quot;: row[&quot;max_temp&quot;],
        }
    )


@dg.asset(
    name=&quot;weather_quality_check_silver&quot;,
    group_name=&quot;weather_quality&quot;,
    deps=[&quot;dbt:fct_weather_readings&quot;],
    description=&quot;Quality checks for silver layer weather data&quot;,
)
def check_silver_weather_quality(
    context: dg.AssetExecutionContext,
    trino: TrinoResource,
) -&gt; dg.MaterializeResult:
    &quot;&quot;&quot;
    Perform quality checks on silver layer weather data.

    Checks:
    - All calculated fields present
    - Categories valid
    - No nulls in required fields
    &quot;&quot;&quot;
    query = &quot;&quot;&quot;
    SELECT
        COUNT(*) as total_records,
        SUM(CASE WHEN temp_category IS NULL THEN 1 ELSE 0 END) as null_categories,
        SUM(CASE WHEN temperature_f IS NULL THEN 1 ELSE 0 END) as null_temp_f,
        COUNT(DISTINCT temp_category) as distinct_categories
    FROM iceberg.silver.fct_weather_readings
    &quot;&quot;&quot;

    result = trino.execute(query)
    row = result[0]

    # Assertions
    assert row[&quot;null_categories&quot;] == 0, f&quot;Found {row['null_categories']} null categories&quot;
    assert row[&quot;null_temp_f&quot;] == 0, f&quot;Found {row['null_temp_f']} null Fahrenheit temps&quot;
    assert row[&quot;distinct_categories&quot;] == 5, f&quot;Expected 5 categories, found {row['distinct_categories']}&quot;

    context.log.info(f&quot;✓ Silver layer quality checks passed&quot;)

    return dg.MaterializeResult(
        metadata={
            &quot;total_records&quot;: row[&quot;total_records&quot;],
            &quot;distinct_categories&quot;: row[&quot;distinct_categories&quot;],
        }
    )


def build_weather_quality_defs() -&gt; dg.Definitions:
    &quot;&quot;&quot;Build quality check definitions.&quot;&quot;&quot;
    return dg.Definitions(
        assets=[
            check_raw_weather_quality,
            check_silver_weather_quality,
        ],
    )
</code></pre>
<h3 id="72-quality-check-discovery">7.2 Quality Check Discovery</h3>
<p>No manual registration is needed. Phlo discovers quality workflows under <code>workflows/quality/</code>.</p>
<hr />
<h2 id="step-8-configure-publishing">Step 8: Configure Publishing</h2>
<p>Configure which tables get published to PostgreSQL for BI tools.</p>
<h3 id="81-update-publishing-config">8.1 Update Publishing Config</h3>
<p>Edit: <code>workflows/publishing/config.yaml</code></p>
<pre><code class="language-yaml"># Existing configurations...

weather:
  description: &quot;Weather data marts for BI dashboards&quot;
  enabled: true
  tables:
    - iceberg_table: &quot;marts.mrt_weather_overview&quot;
      postgres_table: &quot;mrt_weather_overview&quot;
      postgres_schema: &quot;marts&quot;
      description: &quot;Daily weather summary by location&quot;
      mode: &quot;replace&quot; # Options: replace, append, upsert

    - iceberg_table: &quot;marts.mrt_recent_weather&quot;
      postgres_table: &quot;mrt_recent_weather&quot;
      postgres_schema: &quot;marts&quot;
      description: &quot;Most recent weather reading per location&quot;
      mode: &quot;replace&quot;
</code></pre>
<h3 id="82-create-publishing-asset">8.2 Create Publishing Asset</h3>
<p>The publishing asset is already generic and will pick up your config automatically. Just ensure it runs after your dbt models.</p>
<p>Test it:</p>
<pre><code class="language-bash">dagster asset materialize -m phlo.framework.definitions -a publish_postgres_marts
</code></pre>
<hr />
<h2 id="step-9-add-scheduling">Step 9: Add Scheduling</h2>
<p>Schedule your pipeline to run automatically.</p>
<h3 id="91-create-schedule">9.1 Create Schedule</h3>
<p>Edit: <code>workflows/schedules/schedules.py</code></p>
<pre><code class="language-python"># Add to existing schedules

@dg.schedule(
    name=&quot;weather_pipeline_schedule&quot;,
    cron_schedule=&quot;0 * * * *&quot;,  # Every hour
    job=dg.define_asset_job(
        name=&quot;weather_pipeline_job&quot;,
        selection=dg.AssetSelection.groups(&quot;weather&quot;),  # All weather assets
    ),
    default_status=dg.DefaultScheduleStatus.RUNNING,  # Auto-start
    execution_timezone=&quot;UTC&quot;,
)
def weather_pipeline_schedule():
    &quot;&quot;&quot;Run weather pipeline every hour.&quot;&quot;&quot;
    return dg.RunRequest()
</code></pre>
<h3 id="92-add-sensor-for-freshness">9.2 Add Sensor for Freshness</h3>
<p>Create a sensor that alerts if data gets stale:</p>
<pre><code class="language-python">@dg.sensor(
    name=&quot;weather_freshness_sensor&quot;,
    minimum_interval_seconds=300,  # Check every 5 minutes
    default_status=dg.DefaultSensorStatus.RUNNING,
)
def weather_freshness_sensor(context: dg.SensorEvaluationContext):
    &quot;&quot;&quot;Alert if weather data is stale (&gt; 2 hours old).&quot;&quot;&quot;

    # Check last materialization time
    weather_asset_key = dg.AssetKey([&quot;weather_data&quot;])
    latest_materialization = context.instance.get_latest_materialization_event(weather_asset_key)

    if not latest_materialization:
        context.log.warning(&quot;No materialization found for weather_data&quot;)
        return dg.SkipReason(&quot;No materialization yet&quot;)

    from datetime import datetime, timedelta

    last_update = latest_materialization.timestamp
    age = datetime.now().timestamp() - last_update
    age_hours = age / 3600

    if age_hours &gt; 2:
        context.log.error(f&quot;Weather data is {age_hours:.1f} hours old!&quot;)
        # Trigger re-materialization
        return dg.RunRequest(
            asset_selection=[weather_asset_key],
        )

    return dg.SkipReason(f&quot;Data is fresh ({age_hours:.1f} hours old)&quot;)
</code></pre>
<hr />
<h2 id="step-10-test-and-deploy">Step 10: Test and Deploy</h2>
<h3 id="101-run-complete-pipeline">10.1 Run Complete Pipeline</h3>
<pre><code class="language-bash"># Materialize all weather assets
dagster asset materialize -m phlo.framework.definitions \
  --select &quot;tag:weather&quot;

# Or use Dagster UI:
# 1. Open http://localhost:3000
# 2. Assets → Filter by tag: weather
# 3. Select all → Materialize
</code></pre>
<h3 id="102-verify-each-layer">10.2 Verify Each Layer</h3>
<pre><code class="language-sql">-- Check raw data
SELECT COUNT(*), MIN(observation_time), MAX(observation_time)
FROM iceberg.raw.weather_observations;

-- Check bronze data
SELECT COUNT(*) FROM iceberg.bronze.stg_weather_observations;

-- Check silver data
SELECT
    city_name,
    temperature_c,
    temp_category,
    comfort_level
FROM iceberg.silver.fct_weather_readings
ORDER BY observation_timestamp DESC
LIMIT 10;

-- Check gold data
SELECT * FROM iceberg.gold.agg_daily_weather_summary
ORDER BY observation_date DESC;

-- Check marts (in PostgreSQL)
SELECT * FROM marts.mrt_weather_overview
ORDER BY observation_date DESC;
</code></pre>
<h3 id="103-run-dbt-tests">10.3 Run dbt Tests</h3>
<pre><code class="language-bash">docker-compose exec dagster-webserver \
  dbt test --project-dir /opt/dagster/app/transforms/dbt \
  --select tag:weather
</code></pre>
<h3 id="104-create-superset-dashboard">10.4 Create Superset Dashboard</h3>
<ol>
<li>Open Superset: http://localhost:10008</li>
<li>Add PostgreSQL database connection</li>
<li>Create dataset from <code>marts.mrt_weather_overview</code></li>
<li>Create charts:</li>
<li>Line chart: Temperature trends by city</li>
<li>Bar chart: Current temperatures</li>
<li>Table: Recent readings</li>
<li>Add to dashboard</li>
</ol>
<hr />
<h2 id="advanced-patterns">Advanced Patterns</h2>
<h3 id="pattern-1-incremental-processing">Pattern 1: Incremental Processing</h3>
<p>Instead of reprocessing all data, process only new data:</p>
<pre><code class="language-sql">{{
    config(
        materialized='incremental',
        unique_key='observation_timestamp',
        schema='silver'
    )
}}

SELECT * FROM {{ ref('stg_weather_observations') }}

{% if is_incremental() %}
    -- Only new data since last run
    WHERE observation_timestamp &gt; (SELECT MAX(observation_timestamp) FROM {{ this }})
{% endif %}
</code></pre>
<h3 id="pattern-2-partitioned-assets">Pattern 2: Partitioned Assets</h3>
<p>Partition by date for better performance:</p>
<pre><code class="language-python">from dagster import DailyPartitionsDefinition

daily_partition = DailyPartitionsDefinition(start_date=&quot;2024-01-01&quot;)

@dg.asset(
    partitions_def=daily_partition,
    name=&quot;weather_data_partitioned&quot;,
)
def fetch_weather_data_partitioned(context: dg.AssetExecutionContext):
    partition_date = context.partition_key  # &quot;2024-11-05&quot;
    # Fetch only data for this date
    ...
</code></pre>
<h3 id="pattern-3-dynamic-cities">Pattern 3: Dynamic Cities</h3>
<p>Fetch list of cities from a config table instead of hardcoding:</p>
<pre><code class="language-python">@dg.asset
def weather_cities_config(trino: TrinoResource):
    &quot;&quot;&quot;Fetch cities to monitor from config table.&quot;&quot;&quot;
    query = &quot;SELECT city_name, country FROM config.weather_cities WHERE active = true&quot;
    return trino.execute(query)

@dg.asset
def weather_data(weather_cities_config):
    &quot;&quot;&quot;Fetch weather for dynamic list of cities.&quot;&quot;&quot;
    cities = weather_cities_config
    # Fetch for each city...
</code></pre>
<h3 id="pattern-4-error-handling">Pattern 4: Error Handling</h3>
<p>Add retry logic and error notifications:</p>
<pre><code class="language-python">@dg.asset(
    retry_policy=dg.RetryPolicy(
        max_retries=3,
        delay=30,  # seconds
    ),
    op_tags={&quot;notify_on_failure&quot;: &quot;true&quot;},
)
def weather_data_with_retry(...):
    &quot;&quot;&quot;Fetch with automatic retries.&quot;&quot;&quot;
    ...
</code></pre>
<h3 id="pattern-5-caching">Pattern 5: Caching</h3>
<p>Cache expensive operations:</p>
<pre><code class="language-python">from functools import lru_cache

@lru_cache(maxsize=1)
def get_api_client():
    &quot;&quot;&quot;Cached API client.&quot;&quot;&quot;
    return OpenWeatherClient(api_key=config.openweather_api_key)
</code></pre>
<hr />
<h2 id="next-steps">Next Steps</h2>
<p>🎉 <strong>Congratulations!</strong> You've built a complete data pipeline from scratch.</p>
<p><strong>What you've learned:</strong></p>
<ul>
<li>✅ Define schemas</li>
<li>✅ Create ingestion assets</li>
<li>✅ Build Bronze/Silver/Gold layers with dbt</li>
<li>✅ Add data quality checks</li>
<li>✅ Publish to PostgreSQL</li>
<li>✅ Schedule automated runs</li>
<li>✅ Create BI dashboards</li>
</ul>
<p><strong>Continue learning:</strong></p>
<ul>
<li><a href="../data-modeling/">Data Modeling Guide</a> - Best practices for schema design</li>
<li><a href="../dagster-assets/">Dagster Assets Tutorial</a> - Advanced orchestration patterns</li>
<li><a href="../dbt-development/">dbt Development Guide</a> - Advanced SQL techniques</li>
<li><a href="../../operations/troubleshooting/">Troubleshooting Guide</a> - Debug common issues</li>
</ul>
<p><strong>Try these challenges:</strong></p>
<ol>
<li>Add more cities to monitor</li>
<li>Create hourly aggregations</li>
<li>Add weather alerts (e.g., temperature &gt; 35°C)</li>
<li>Integrate with another API</li>
<li>Create predictive features for ML</li>
</ol>
<p><strong>Happy data engineering!</strong> 🌤️</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.prune", "navigation.indexes", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>