
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Phlo data lakehouse platform">
      
      
        <meta name="author" content="Phlo Team">
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Part 12: Production Deployment and Scaling - Phlo Lakehouse Platform</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-12-production-deployment-and-scaling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Phlo Lakehouse Platform" class="md-header__button md-logo" aria-label="Phlo Lakehouse Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Phlo Lakehouse Platform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part 12: Production Deployment and Scaling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Phlo Lakehouse Platform" class="md-nav__button md-logo" aria-label="Phlo Lakehouse Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Phlo Lakehouse Platform
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../getting-started/installation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../guides/developer-guide/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../setup/hasura/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../packages/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Packages
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../reference/architecture/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../operations/operations-guide/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#development-vs-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development vs Production
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-from-laptop-to-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture: From Laptop to Kubernetes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture: From Laptop to Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-docker-compose-development" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 1: Docker Compose (Development)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-single-server-small-prod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2: Single Server (Small Prod)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-3-kubernetes-high-scale-prod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 3: Kubernetes (High-Scale Prod)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-prepare-the-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Prepare the Environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1b-infrastructure-configuration-phloyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1b: Infrastructure Configuration (phlo.yaml)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1b: Infrastructure Configuration (phlo.yaml)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-infrastructure-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Infrastructure Configuration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-phloyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating phlo.yaml
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-project-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Project Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-loading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Loading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Best Practices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-deploy-with-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Deploy with Docker Compose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-verify-service-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Verify Service Health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-storage-configuration-production-s3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Storage Configuration (Production S3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-observability-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Observability Stack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-kubernetes-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future: Kubernetes Deployment
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scaling Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertical-scaling-bigger-machines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vertical Scaling (Bigger Machines)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling-more-machines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Horizontal Scaling (More Machines)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoscaling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Autoscaling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-availability" class="md-nav__link">
    <span class="md-ellipsis">
      
        High Availability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="High Availability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-failover" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Failover
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-redundancy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Redundancy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disaster-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disaster Recovery
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cost Optimization
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Production
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-implementation-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Implementation (Docker Compose)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-readiness-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Readiness Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="part-12-production-deployment-and-scaling">Part 12: Production Deployment and Scaling</h1>
<p>You've built, tested, and monitored your data lakehouse. Now let's deploy it to production and scale it reliably.</p>
<h2 id="development-vs-production">Development vs Production</h2>
<p>What differs between your laptop and production:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Development</th>
<th>Production</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Uptime SLA</strong></td>
<td>None (stop anytime)</td>
<td>99.9%+</td>
</tr>
<tr>
<td><strong>Data Retention</strong></td>
<td>Days</td>
<td>Years</td>
</tr>
<tr>
<td><strong>Backup Strategy</strong></td>
<td>Optional</td>
<td>Required (PITR)</td>
</tr>
<tr>
<td><strong>Access Control</strong></td>
<td>All devs have all access</td>
<td>Role-based, audited</td>
</tr>
<tr>
<td><strong>Failure Recovery</strong></td>
<td>Restart containers</td>
<td>Auto-recovery, failover</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>None (ad-hoc)</td>
<td>Continuous</td>
</tr>
<tr>
<td><strong>Capacity</strong></td>
<td>16GB RAM, 1TB disk</td>
<td>256GB+ RAM, PB+ storage</td>
</tr>
<tr>
<td><strong>Cost</strong></td>
<td>Minimal</td>
<td>Optimized</td>
</tr>
<tr>
<td><strong>Compliance</strong></td>
<td>None</td>
<td>HIPAA, GDPR, etc.</td>
</tr>
</tbody>
</table>
<h2 id="architecture-from-laptop-to-kubernetes">Architecture: From Laptop to Kubernetes</h2>
<h3 id="stage-1-docker-compose-development">Stage 1: Docker Compose (Development)</h3>
<pre><code>┌─────────────────────────────┐
│   Docker Compose Host       │
├─────────────────────────────┤
│ ┌──────────┐ ┌──────────┐  │
│ │ Dagster  │ │ Trino    │  │
│ └──────────┘ └──────────┘  │
│ ┌──────────┐ ┌──────────┐  │
│ │ MinIO    │ │ Postgres │  │
│ └──────────┘ └──────────┘  │
│ ┌──────────┐ ┌──────────┐  │
│ │ Nessie   │ │ Superset │  │
│ └──────────┘ └──────────┘  │
└─────────────────────────────┘

Use: docker-compose up
</code></pre>
<h3 id="stage-2-single-server-small-prod">Stage 2: Single Server (Small Prod)</h3>
<pre><code>┌──────────────────────────────────┐
│     Production Server            │
│     (AWS EC2, DigitalOcean)      │
├──────────────────────────────────┤
│ ┌────────────────────────────┐   │
│ │   Systemd Services         │   │
│ │  (instead of docker-compose)   │
│ │                            │   │
│ │ ├─ Dagster (web + daemon) │   │
│ │ ├─ Trino                   │   │
│ │ ├─ Postgres                │   │
│ │ └─ MinIO                   │   │
│ └────────────────────────────┘   │
│                                  │
│  + S3-compatible external storage│
│  + Managed RDS for Postgres      │
│  + CloudWatch monitoring         │
└──────────────────────────────────┘
</code></pre>
<h3 id="stage-3-kubernetes-high-scale-prod">Stage 3: Kubernetes (High-Scale Prod)</h3>
<pre><code>┌─────────────────────────────────────────┐
│      Kubernetes Cluster                 │
├─────────────────────────────────────────┤
│  ┌──────────────────────────────────┐   │
│  │    Namespace: dagster          │   │
│  │  ┌────────────────────────────┐ │   │
│  │  │  Dagster Webserver Pods    │ │   │
│  │  │  (replicas: 2)             │ │   │
│  │  └────────────────────────────┘ │   │
│  │  ┌────────────────────────────┐ │   │
│  │  │  Dagster Daemon Pods       │ │   │
│  │  │  (replicas: 1)             │ │   │
│  │  └────────────────────────────┘ │   │
│  │  ┌────────────────────────────┐ │   │
│  │  │  Compute Pods (auto-scale) │ │   │
│  │  │  (replicas: 1-10)          │ │   │
│  │  └────────────────────────────┘ │   │
│  └──────────────────────────────────┘   │
│  ┌──────────────────────────────────┐   │
│  │    Namespace: data-warehouse    │   │
│  │  ├─ Trino Coordinator           │   │
│  │  ├─ Trino Workers (3-10)        │   │
│  │  └─ Nessie                      │   │
│  └──────────────────────────────────┘   │
│                                          │
│  External Services:                      │
│  ├─ AWS RDS (Postgres, HA)              │
│  ├─ AWS S3 (data lake)                  │
│  ├─ AWS ElastiCache (caching)           │
│  └─ AWS CloudWatch (monitoring)         │
└─────────────────────────────────────────┘
</code></pre>
<h2 id="deployment-steps">Deployment Steps</h2>
<h3 id="step-1-prepare-the-environment">Step 1: Prepare the Environment</h3>
<p>Phlo uses environment variables for configuration. Generate local env files and set defaults:</p>
<pre><code class="language-bash"># Generate .phlo/.env and .phlo/.env.local
phlo services init

# Copy secrets template
cp .env.example .phlo/.env.local
</code></pre>
<p>Based on the actual <code>.env.example</code>, here are the critical production settings:</p>
<pre><code class="language-yaml"># phlo.yaml (committed defaults)
env:
  # Database (consider managed RDS for production)
  POSTGRES_USER: lake
  POSTGRES_DB: lakehouse
  POSTGRES_PORT: 10000

  # MinIO / S3 Storage
  MINIO_API_PORT: 10001
  MINIO_CONSOLE_PORT: 10002

  # Nessie (Data Catalog)
  NESSIE_VERSION: 0.105.5
  NESSIE_PORT: 10003

  # Trino (Query Engine)
  TRINO_VERSION: 477
  TRINO_PORT: 10005

  # Iceberg Configuration
  ICEBERG_WAREHOUSE_PATH: s3://lake/warehouse
  ICEBERG_STAGING_PATH: s3://lake/stage
  ICEBERG_NESSIE_REF: main

  # Dagster (Orchestration)
  DAGSTER_PORT: 10006

  # Superset (BI)
  SUPERSET_PORT: 10007

  # API Layer
  API_PORT: 10010

  # Observability Stack
  GRAFANA_PORT: 10016
  PROMETHEUS_PORT: 10013

  # Data Catalog (OpenMetadata)
  OPENMETADATA_PORT: 10020
</code></pre>
<pre><code class="language-bash"># .phlo/.env.local (secrets, not committed)
POSTGRES_PASSWORD=&lt;SECURE_PASSWORD&gt;  # Change from default!
MINIO_ROOT_USER=&lt;SECURE_USER&gt;        # Change from default!
MINIO_ROOT_PASSWORD=&lt;SECURE_PASSWORD&gt;
SUPERSET_ADMIN_PASSWORD=&lt;SECURE_PASSWORD&gt;
JWT_SECRET=&lt;SECURE_JWT_SECRET&gt;
HASURA_ADMIN_SECRET=&lt;SECURE_ADMIN_SECRET&gt;
POSTGREST_AUTHENTICATOR_PASSWORD=&lt;SECURE_PASSWORD&gt;
GRAFANA_ADMIN_PASSWORD=&lt;SECURE_PASSWORD&gt;
OPENMETADATA_ADMIN_PASSWORD=&lt;SECURE_PASSWORD&gt;
OPENMETADATA_MYSQL_PASSWORD=&lt;SECURE_PASSWORD&gt;
</code></pre>
<h3 id="step-1b-infrastructure-configuration-phloyaml">Step 1b: Infrastructure Configuration (phlo.yaml)</h3>
<p>For production deployments, especially when running multiple Phlo projects or customizing service configurations, use <code>phlo.yaml</code> for project-level infrastructure settings.</p>
<h4 id="why-infrastructure-configuration">Why Infrastructure Configuration?</h4>
<p>Secrets in <code>.phlo/.env.local</code> and defaults in <code>phlo.yaml</code> (env:) handle configuration, but they don't handle:</p>
<ul>
<li><strong>Multi-project deployments</strong>: Running multiple Phlo instances on the same host</li>
<li><strong>Container naming patterns</strong>: Custom naming for service discovery</li>
<li><strong>Port customization</strong>: Per-project port assignments</li>
<li><strong>Service-specific overrides</strong>: Custom configurations for individual services</li>
</ul>
<h4 id="creating-phloyaml">Creating phlo.yaml</h4>
<p>Create a <code>phlo.yaml</code> file in your project root:</p>
<pre><code class="language-yaml"># phlo.yaml - Production infrastructure configuration

name: production-lakehouse
description: Production data lakehouse for analytics

infrastructure:
  # Container naming pattern (supports {{project}} and {{service}} variables)
  container_naming_pattern: &quot;{{project}}-{{service}}-1&quot;

  # Service-specific configuration
  services:
    dagster_webserver:
      container_name: null # Use pattern above
      service_name: dagster-webserver
      host: localhost
      internal_host: dagster-webserver
      port: 10006

    postgres:
      container_name: null
      service_name: postgres
      host: localhost
      internal_host: postgres
      port: 10000
      credentials:
        user: postgres
        password: ${POSTGRES_PASSWORD} # References .phlo/.env.local
        database: cascade

    minio:
      container_name: null
      service_name: minio
      host: localhost
      internal_host: minio
      api_port: 10001
      console_port: 10002

    nessie:
      container_name: null
      service_name: nessie
      host: localhost
      internal_host: nessie
      port: 10003

    trino:
      container_name: null
      service_name: trino
      host: localhost
      internal_host: trino
      port: 10005
</code></pre>
<h4 id="multi-project-example">Multi-Project Example</h4>
<p>Running two Phlo projects on the same server:</p>
<p><strong>Project 1: Analytics Lakehouse</strong></p>
<pre><code class="language-yaml"># analytics/phlo.yaml
name: analytics
description: Analytics data lakehouse

infrastructure:
  container_naming_pattern: &quot;{{project}}-{{service}}-1&quot;
  services:
    dagster_webserver:
      port: 11006 # Different port
    postgres:
      port: 11000
    # ... other services with unique ports
</code></pre>
<p><strong>Project 2: ML Platform</strong></p>
<pre><code class="language-yaml"># ml-platform/phlo.yaml
name: ml-platform
description: Machine learning data platform

infrastructure:
  container_naming_pattern: &quot;{{project}}-{{service}}-1&quot;
  services:
    dagster_webserver:
      port: 12006 # Different port
    postgres:
      port: 12000
    # ... other services with unique ports
</code></pre>
<p>Now you can run both simultaneously:</p>
<pre><code class="language-bash"># Terminal 1: Analytics project
cd analytics/
phlo services start

# Terminal 2: ML platform
cd ml-platform/
phlo services start

# Check running containers
docker ps
# Shows:
# - analytics-dagster-webserver-1 (port 11006)
# - analytics-postgres-1 (port 11000)
# - ml-platform-dagster-webserver-1 (port 12006)
# - ml-platform-postgres-1 (port 12000)
</code></pre>
<h4 id="configuration-loading">Configuration Loading</h4>
<p>Phlo automatically loads configuration in this order:</p>
<ol>
<li><strong>phlo.yaml</strong> (project-level infrastructure + env defaults)</li>
<li><strong>.phlo/.env</strong> (generated non-secret defaults)</li>
<li><strong>.phlo/.env.local</strong> (secrets and local overrides)</li>
<li><strong>Environment variables</strong> (runtime overrides)</li>
<li><strong>Defaults</strong> (built-in fallbacks)</li>
</ol>
<p>Access configuration programmatically:</p>
<pre><code class="language-python">from phlo.infrastructure.config import (
    load_infrastructure_config,
    get_container_name,
    get_service_config
)

# Load project configuration
config = load_infrastructure_config()
print(config.name)  # &quot;production-lakehouse&quot;

# Get container name for a service
container = get_container_name(&quot;dagster-webserver&quot;)
# Returns: &quot;production-lakehouse-dagster-webserver-1&quot;

# Get service configuration
postgres_config = get_service_config(&quot;postgres&quot;)
print(postgres_config[&quot;port&quot;])  # 10000
print(postgres_config[&quot;internal_host&quot;])  # &quot;postgres&quot;
</code></pre>
<h4 id="production-best-practices">Production Best Practices</h4>
<p><strong>1. Use descriptive project names:</strong></p>
<pre><code class="language-yaml">name: prod-analytics-us-east
description: Production analytics lakehouse (US East region)
</code></pre>
<p><strong>2. Document service purposes:</strong></p>
<pre><code class="language-yaml">services:
  dagster_webserver:
    description: Dagster UI and GraphQL API
    port: 10006
</code></pre>
<p><strong>3. Reference secrets from .phlo/.env.local:</strong></p>
<pre><code class="language-yaml">postgres:
  credentials:
    password: ${POSTGRES_PASSWORD} # Never hardcode secrets
</code></pre>
<p><strong>4. Version control phlo.yaml:</strong></p>
<pre><code class="language-bash"># Commit to git (no secrets here)
git add phlo.yaml
git commit -m &quot;Add infrastructure configuration&quot;

# But NOT .phlo/.env.local (contains secrets)
echo &quot;.phlo/.env.local&quot; &gt;&gt; .gitignore
</code></pre>
<p><strong>5. Use different configs per environment:</strong></p>
<pre><code class="language-bash">phlo.yaml              # Base configuration
phlo.staging.yaml      # Staging overrides
phlo.production.yaml   # Production overrides
</code></pre>
<h4 id="service-discovery">Service Discovery</h4>
<p>With infrastructure configuration, services can discover each other:</p>
<pre><code class="language-python">from phlo.infrastructure.config import get_service_config

# Get Postgres connection from config
pg_config = get_service_config(&quot;postgres&quot;)
connection_string = (
    f&quot;postgresql://{pg_config['credentials']['user']}:&quot;
    f&quot;{pg_config['credentials']['password']}@&quot;
    f&quot;{pg_config['internal_host']}:{pg_config['port']}/&quot;
    f&quot;{pg_config['credentials']['database']}&quot;
)

# Get Trino endpoint
trino_config = get_service_config(&quot;trino&quot;)
trino_endpoint = f&quot;http://{trino_config['internal_host']}:{trino_config['port']}&quot;
</code></pre>
<h4 id="kubernetes-integration">Kubernetes Integration</h4>
<p>For Kubernetes deployments, <code>phlo.yaml</code> provides a single source of truth:</p>
<pre><code class="language-bash"># Generate k8s manifests from phlo.yaml
phlo k8s generate --config phlo.yaml

# Deploys with:
# - Service names from phlo.yaml
# - Port mappings from phlo.yaml
# - Resource limits from phlo.yaml
</code></pre>
<p>This ensures consistency between Docker Compose (dev) and Kubernetes (prod).</p>
<h3 id="step-2-deploy-with-docker-compose">Step 2: Deploy with Docker Compose</h3>
<p>Phlo includes a comprehensive <code>docker-compose.yml</code> that orchestrates all services. For production, you have options:</p>
<p><strong>Option A: Docker Compose (Current Implementation)</strong></p>
<pre><code class="language-bash"># Start all core services
docker-compose up -d

# Or start with observability stack
docker-compose --profile observability up -d

# Or start with API layer
docker-compose --profile api up -d

# Or start with data catalog
docker-compose --profile catalog up -d

# Or start everything
docker-compose --profile all up -d

# Check service health
docker-compose ps
</code></pre>
<p>The actual <code>docker-compose.yml</code> includes:</p>
<ul>
<li><strong>Core Services</strong>: postgres, minio, nessie, trino, dagster-webserver, dagster-daemon, superset</li>
<li><strong>Observability</strong> (profile: observability): prometheus, loki, grafana, alloy, postgres-exporter</li>
<li><strong>API Layer</strong> (profile: api): FastAPI, Hasura GraphQL, PostgREST</li>
<li><strong>Data Catalog</strong> (profile: catalog): OpenMetadata with MySQL and Elasticsearch</li>
<li><strong>Documentation</strong> (profile: docs): MkDocs server</li>
</ul>
<p><strong>Option B: Managed Services (Recommended for Production)</strong></p>
<p>For production workloads, consider replacing containerized services with managed alternatives:</p>
<pre><code class="language-bash"># Use AWS RDS for PostgreSQL
POSTGRES_HOST=phlo-prod.xxxxx.rds.amazonaws.com
POSTGRES_PORT=5432

# Use AWS S3 instead of MinIO
ICEBERG_WAREHOUSE_PATH=s3://your-prod-bucket/warehouse
MINIO_API_PORT=9000  # Or S3 endpoint

# Keep Dagster, Trino, Nessie containerized with docker-compose
docker-compose up -d dagster-webserver dagster-daemon trino nessie
</code></pre>
<h3 id="step-3-verify-service-health">Step 3: Verify Service Health</h3>
<p>The docker-compose configuration includes health checks for all services:</p>
<pre><code class="language-bash"># View service status
docker-compose ps

# Check logs for specific service
docker-compose logs -f dagster-webserver
docker-compose logs -f trino
docker-compose logs -f nessie

# Access services
# Dagster UI: http://localhost:10006
# Trino: http://localhost:10005
# Nessie API: http://localhost:10003
# Superset: http://localhost:10007
# MinIO Console: http://localhost:10002
# Grafana (with observability profile): http://localhost:10016
# OpenMetadata (with catalog profile): http://localhost:10020
</code></pre>
<h3 id="step-4-storage-configuration-production-s3">Step 4: Storage Configuration (Production S3)</h3>
<p>For production, replace MinIO with AWS S3:</p>
<pre><code class="language-bash"># Create S3 bucket
aws s3 mb s3://phlo-prod-lake --region us-east-1

# Enable versioning (for Nessie and time-travel)
aws s3api put-bucket-versioning \
  --bucket phlo-prod-lake \
  --versioning-configuration Status=Enabled

# Enable encryption
aws s3api put-bucket-encryption \
  --bucket phlo-prod-lake \
  --server-side-encryption-configuration '{
    &quot;Rules&quot;: [{
      &quot;ApplyServerSideEncryptionByDefault&quot;: {
        &quot;SSEAlgorithm&quot;: &quot;AES256&quot;
      }
    }]
  }'

# Update environment variables
ICEBERG_WAREHOUSE_PATH=s3://phlo-prod-lake/warehouse
ICEBERG_STAGING_PATH=s3://phlo-prod-lake/stage
AWS_ACCESS_KEY_ID=&lt;your-access-key&gt;
AWS_SECRET_ACCESS_KEY=&lt;your-secret-key&gt;
AWS_REGION=us-east-1
</code></pre>
<h3 id="step-5-observability-stack">Step 5: Observability Stack</h3>
<p>Enable Grafana, Prometheus, and Loki for monitoring:</p>
<pre><code class="language-bash"># Start with observability profile
docker-compose --profile observability up -d

# Access Grafana at http://localhost:10016
# Default credentials from .phlo/.env.local:
# Username: admin
# Password: admin123 (change in production!)

# Prometheus metrics: http://localhost:10013
# Loki logs: Accessible via Grafana data source
</code></pre>
<p>The observability stack includes:</p>
<ul>
<li><strong>Prometheus</strong>: Metrics collection and storage</li>
<li><strong>Loki</strong>: Log aggregation</li>
<li><strong>Grafana</strong>: Dashboards and visualization</li>
<li><strong>Alloy</strong>: Metrics and log forwarding</li>
<li><strong>postgres-exporter</strong>: PostgreSQL metrics</li>
</ul>
<h2 id="future-kubernetes-deployment">Future: Kubernetes Deployment</h2>
<blockquote>
<p><strong>Note</strong>: Kubernetes manifests are not yet included in the repository. The following is a reference architecture for future implementation.</p>
</blockquote>
<p>For large-scale production deployments, Kubernetes provides better orchestration:</p>
<pre><code class="language-yaml"># Future: k8s/dagster-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dagster-webserver
  namespace: dagster
spec:
  replicas: 2
  selector:
    matchLabels:
      app: dagster-webserver
  template:
    metadata:
      labels:
        app: dagster-webserver
      annotations:
        prometheus.io/scrape: &quot;true&quot;
        prometheus.io/port: &quot;9090&quot;
        prometheus.io/path: &quot;/metrics&quot;
    spec:
      serviceAccountName: dagster
      containers:
        - name: dagster-webserver
          image: &lt;ACCOUNT_ID&gt;.dkr.ecr.us-east-1.amazonaws.com/phlo:1.0.0
          ports:
            - containerPort: 3000
              name: http
            - containerPort: 9090
              name: metrics

          # Resource limits
          resources:
            requests:
              memory: &quot;2Gi&quot;
              cpu: &quot;1000m&quot;
            limits:
              memory: &quot;4Gi&quot;
              cpu: &quot;2000m&quot;

          # Environment from secrets
          envFrom:
            - secretRef:
                name: phlo-secrets
            - configMapRef:
                name: phlo-config

          # Health checks
          livenessProbe:
            httpGet:
              path: /health
              port: 3000
            initialDelaySeconds: 40
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3

          readinessProbe:
            httpGet:
              path: /ready
              port: 3000
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 5
            failureThreshold: 1

          # Logging
          volumeMounts:
            - name: logs
              mountPath: /app/logs

      # Node selection
      nodeSelector:
        workload: compute

      # Pod disruption budget (for rolling updates)
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 100
              podAffinityTerm:
                labelSelector:
                  matchExpressions:
                    - key: app
                      operator: In
                      values:
                        - dagster-webserver
                topologyKey: kubernetes.io/hostname

      volumes:
        - name: logs
          emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: dagster-webserver
  namespace: dagster
spec:
  type: LoadBalancer
  selector:
    app: dagster-webserver
  ports:
    - port: 80
      targetPort: 3000
      protocol: TCP
</code></pre>
<p><strong>Future Kubernetes deployment</strong> would look like:</p>
<pre><code class="language-bash"># Create namespace
kubectl create namespace dagster

# Create secrets from .phlo/.env.local
kubectl create secret generic phlo-secrets \
  --from-env-file=.phlo/.env.local \
  -n dagster

# Deploy (when k8s/ manifests are available)
kubectl apply -f k8s/dagster-deployment.yaml
kubectl apply -f k8s/trino-deployment.yaml
kubectl apply -f k8s/nessie-deployment.yaml

# Monitor rollout
kubectl rollout status deployment/dagster-webserver -n dagster
</code></pre>
<h2 id="scaling-strategies">Scaling Strategies</h2>
<h3 id="vertical-scaling-bigger-machines">Vertical Scaling (Bigger Machines)</h3>
<pre><code class="language-bash"># Increase machine size for compute-intensive workloads
kubectl set resources deployment dagster-compute \
  --requests=cpu=2000m,memory=8Gi \
  --limits=cpu=4000m,memory=16Gi \
  -n dagster
</code></pre>
<h3 id="horizontal-scaling-more-machines">Horizontal Scaling (More Machines)</h3>
<pre><code class="language-bash"># Add more Trino workers
kubectl scale deployment trino-worker --replicas=10 -n data-warehouse

# Add more Dagster compute pods
kubectl set env deployment/dagster-compute \
  DAGSTER_K8S_INSTANCE_CONFIG_WORKERS=10 \
  -n dagster
</code></pre>
<h3 id="autoscaling">Autoscaling</h3>
<pre><code class="language-yaml"># k8s/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: dagster-compute-hpa
  namespace: dagster
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: dagster-compute
  minReplicas: 1
  maxReplicas: 20
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 30
      selectPolicy: Max
</code></pre>
<h2 id="high-availability">High Availability</h2>
<h3 id="database-failover">Database Failover</h3>
<pre><code class="language-bash"># RDS Multi-AZ setup (automatic failover)
aws rds modify-db-instance \
  --db-instance-identifier phlo-prod \
  --multi-az \
  --apply-immediately

# Automated backups
aws rds modify-db-instance \
  --db-instance-identifier phlo-prod \
  --backup-retention-period 30 \
  --preferred-backup-window &quot;03:00-04:00&quot; \
  --apply-immediately

# Point-in-time recovery
aws rds restore-db-instance-to-point-in-time \
  --source-db-instance-identifier phlo-prod \
  --target-db-instance-identifier phlo-prod-restored \
  --restore-time 2024-10-15T10:30:00Z
</code></pre>
<h3 id="service-redundancy">Service Redundancy</h3>
<pre><code class="language-yaml"># k8s/pdb.yaml (Pod Disruption Budget)
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: dagster-pdb
  namespace: dagster
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: dagster-webserver
</code></pre>
<p>This ensures at least 1 pod is always running during maintenance.</p>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<p><strong>Current Implementation: Docker Compose Backups</strong></p>
<pre><code class="language-bash"># Backup PostgreSQL database
docker-compose exec postgres pg_dump -U lake lakehouse &gt; backup_$(date +%Y%m%d).sql

# Backup MinIO data (if using MinIO)
docker run --rm -v $(pwd)/volumes/minio:/data -v $(pwd)/backups:/backup \
  alpine tar czf /backup/minio_$(date +%Y%m%d).tar.gz /data

# For production S3, use cross-region replication
aws s3api put-bucket-replication \
  --bucket phlo-prod-lake \
  --replication-configuration file://replication.json
</code></pre>
<p><strong>Future: Kubernetes Backup Automation</strong></p>
<pre><code class="language-bash"># Future backup automation with CronJob
cat &gt; k8s/backup-cronjob.yaml &lt;&lt; 'EOF'
apiVersion: batch/v1
kind: CronJob
metadata:
  name: phlo-backup
  namespace: dagster
spec:
  schedule: &quot;0 2 * * *&quot;  # 2 AM daily
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: dagster
          containers:
          - name: backup
            image: amazon/aws-cli:latest
            command:
            - /bin/sh
            - -c
            - |
              aws s3 sync s3://phlo-prod-lake s3://phlo-prod-backup \
                --delete \
                --exclude &quot;tmp/*&quot; \
                --region us-east-1
            env:
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: aws-credentials
                  key: access_key
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: aws-credentials
                  key: secret_key
          restartPolicy: OnFailure
EOF

kubectl apply -f k8s/backup-cronjob.yaml
</code></pre>
<h2 id="cost-optimization">Cost Optimization</h2>
<pre><code class="language-python"># phlo/monitoring/cost_tracking.py
import boto3

def estimate_monthly_cost():
    &quot;&quot;&quot;Estimate AWS costs.&quot;&quot;&quot;

    # S3 storage costs
    s3 = boto3.client('s3')
    response = s3.list_bucket_metrics_configurations(Bucket='phlo-prod-lake')

    storage_size_gb = get_bucket_size() / (1024**3)
    storage_cost = storage_size_gb * 0.023  # $0.023/GB/month

    # RDS costs
    rds = boto3.client('rds')
    instances = rds.describe_db_instances()
    rds_cost = len(instances) * 365  # Estimate

    # Compute costs (EC2/ECS)
    ec2 = boto3.client('ec2')
    instances = ec2.describe_instances()
    compute_cost = len(instances) * 150  # Estimate

    total = storage_cost + rds_cost + compute_cost

    print(f&quot;Monthly cost estimate:&quot;)
    print(f&quot;  Storage (S3): ${storage_cost:,.0f}&quot;)
    print(f&quot;  Database (RDS): ${rds_cost:,.0f}&quot;)
    print(f&quot;  Compute (K8s): ${compute_cost:,.0f}&quot;)
    print(f&quot;  Total: ${total:,.0f}&quot;)

    return {
        &quot;storage&quot;: storage_cost,
        &quot;database&quot;: rds_cost,
        &quot;compute&quot;: compute_cost,
        &quot;total&quot;: total,
    }

# Optimization strategies
def optimize_costs():
    &quot;&quot;&quot;Implement cost optimization.&quot;&quot;&quot;

    # 1. S3 Intelligent-Tiering
    # Automatically move old data to cheaper storage classes

    # 2. Reserved Instances
    # Commit to 1-3 year terms for 40% discount

    # 3. Spot instances for Trino workers
    # Use spot instances for non-critical compute

    # 4. Data lifecycle policies
    # Archive to Glacier after 90 days

    # 5. Compression
    # Compress old Parquet files
    pass
</code></pre>
<h2 id="monitoring-production">Monitoring Production</h2>
<p><strong>Current Implementation: Grafana + Prometheus</strong></p>
<pre><code class="language-bash"># Start observability stack
docker-compose --profile observability up -d

# Access Grafana dashboards
# http://localhost:10016

# View Prometheus metrics
# http://localhost:10013

# Query logs with Loki
# Available via Grafana Explore interface
</code></pre>
<p>Grafana dashboards are pre-provisioned in <code>.phlo/grafana/dashboards/</code>:</p>
<ul>
<li>Lakehouse overview</li>
<li>Dagster pipeline metrics</li>
<li>PostgreSQL database metrics</li>
<li>Trino query performance</li>
</ul>
<p><strong>Future: Cloud-Native Monitoring</strong></p>
<p>For AWS deployments, integrate with CloudWatch:</p>
<pre><code class="language-bash"># CloudWatch dashboard
aws cloudwatch put-dashboard \
  --dashboard-name PhloProductionStatus \
  --dashboard-body file://dashboard.json

# Set up alerts
aws cloudwatch put-metric-alarm \
  --alarm-name phlo-dagster-failures \
  --alarm-description &quot;Alert on Dagster failures&quot; \
  --metric-name PipelineFailures \
  --namespace Phlo \
  --statistic Sum \
  --period 300 \
  --threshold 1 \
  --comparison-operator GreaterThanThreshold
</code></pre>
<h2 id="summary">Summary</h2>
<p>Production deployment with Phlo:</p>
<h3 id="current-implementation-docker-compose">Current Implementation (Docker Compose)</h3>
<p><strong>Deployment Method</strong>: <code>docker-compose up -d</code> with profiles
<strong>Infrastructure</strong>: Containerized services with health checks
<strong>Storage</strong>: MinIO (dev) or S3 (production)
<strong>Database</strong>: PostgreSQL (containerized or RDS)
<strong>Monitoring</strong>: Grafana + Prometheus + Loki
<strong>Scaling</strong>: Vertical (increase container resources)</p>
<h3 id="production-readiness-checklist">Production Readiness Checklist</h3>
<p>✅ <strong>Implemented</strong>:</p>
<ul>
<li>Docker Compose orchestration with health checks</li>
<li>Environment-based configuration (<code>phlo.yaml</code> + <code>.phlo/.env.local</code>)</li>
<li>Observability stack (Grafana, Prometheus, Loki)</li>
<li>API layer with authentication (FastAPI, Hasura, PostgREST)</li>
<li>Data catalog integration (OpenMetadata)</li>
<li>Multi-profile deployment (core, observability, api, catalog)</li>
</ul>
<p>📋 <strong>Recommended for Production</strong>:</p>
<ul>
<li>Replace MinIO with AWS S3 or similar object storage</li>
<li>Use managed PostgreSQL (RDS, Cloud SQL)</li>
<li>Implement backup automation</li>
<li>Set up SSL/TLS certificates</li>
<li>Configure firewall rules and VPC</li>
<li>Change all default passwords in <code>.phlo/.env.local</code></li>
<li>Enable audit logging</li>
</ul>
<p>🔮 <strong>Future (Kubernetes)</strong>:</p>
<ul>
<li>Kubernetes manifests for k8s/ directory</li>
<li>Horizontal pod autoscaling</li>
<li>Multi-region deployment</li>
<li>Service mesh integration</li>
</ul>
<h3 id="quick-start">Quick Start</h3>
<pre><code class="language-bash"># Development
phlo services init
docker-compose up -d

# Production (all features)
cp .env.example .phlo/.env.local
# Edit .phlo/.env.local with production credentials
docker-compose --profile all up -d

# Access services
# Dagster: http://localhost:10006
# Grafana: http://localhost:10016
# Superset: http://localhost:10007
# OpenMetadata: http://localhost:10020
</code></pre>
<hr />
<p><strong>Next</strong>: <a href="../13-plugin-system/">Part 13 - Plugin System</a> - Extend Phlo with custom plugins</p>
<p><strong>Series</strong>:</p>
<ol>
<li>Data Lakehouse concepts</li>
<li>Getting started</li>
<li>Apache Iceberg</li>
<li>Project Nessie</li>
<li>Data ingestion</li>
<li>dbt transformations</li>
<li>Dagster orchestration</li>
<li>Real-world example</li>
<li>Data quality with Pandera</li>
<li>Metadata and governance</li>
<li>Observability and monitoring</li>
<li><strong>Production deployment</strong> ← You are here</li>
<li>Plugin system</li>
</ol>
<p>Happy data engineering!</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.prune", "navigation.indexes", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>